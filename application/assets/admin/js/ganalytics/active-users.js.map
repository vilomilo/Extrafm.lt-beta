{"version":3,"sources":["active-users.js"],"names":[],"mappings":"AAiBA,KAAA,UAAA,MAAA,WAEA,KAAA,UAAA,gBAAA,eAEA,WAAA,WACA,KAAA,YAAA,GAGA,QAAA,WAEA,KAAA,UACA,KAAA,OAGA,KAAA,UAGA,KAAA,UAAA,KAAA,eACA,KAAA,kBAGA,KAAA,UAAA,KAAA,KAAA,UAAA,KAAA,gBAAA,KAAA,QAIA,KAAA,WACA,aAAA,KAAA,UACA,KAAA,UAAA,EACA,KAAA,KAAA,QAAA,YAAA,KAAA,eAGA,QAAA,WACA,GAAA,GAAA,KAAA,KAGA,MAAA,UAAA,gBAAA,GAAA,UACA,SAAA,eAAA,EAAA,WAAA,EAAA,UAEA,KAAA,UAAA,UAAA,EAAA,UAAA,KAAA,SACA,KAAA,UAAA,cAAA,KAAA,UAAA,KAAA,aAGA,gBAAA,WACA,GAAA,GAAA,KAAA,MACA,EAAA,KAAA,EAAA,iBAAA,EAEA,IAAA,MAAA,IAAA,IAAA,EACA,KAAA,IAAA,OAAA,uCAGA,MAAA,UAAA,EACA,KAAA,OAAA,UAAA,KAAA,SACA,KAAA,IAAA,EAAA,IAAA,QAAA,mBACA,QAAA,SAAA,GAEA,GAAA,GAAA,EAAA,cAAA,EAAA,KAAA,GAAA,GAAA,EACA,EAAA,KAAA,WAEA,MAAA,KAAA,WAAA,YAAA,KAAA,cAEA,GAAA,IACA,KAAA,YAAA,EACA,KAAA,UAAA,EAAA,KAGA,KAAA,UAAA,KACA,KAAA,SAAA,WAAA,KAAA,gBAAA,KAAA,MACA,KAEA,KAAA,QAGA,UAAA,SAAA,GACA,GAAA,GAAA,KAAA,UAAA,cAAA,IACA,KAAA,EAAA,UAAA,KAAA,aAEA,KAAA,KAAA,UAAA,YAAA,KAAA,YAAA,MAAA,IACA,EAAA,EACA,KAAA,KAAA,YAAA,YAAA,KAAA,YAAA,MAAA,IAGA,KAAA,KAAA,YAAA,YAAA,KAAA,YAAA,MAAA,KAIA,SACA","file":"active-users.js","sourcesContent":["// Copyright 2014 Google Inc. All rights reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n/* global gapi */\n\ngapi.analytics.ready(function() {\n\n  gapi.analytics.createComponent('ActiveUsers', {\n\n    initialize: function() {\n      this.activeUsers = 0;\n    },\n\n    execute: function() {\n      // Stop any polling currently going on.\n      if (this.polling_) {\n        this.stop();\n      }\n\n      this.render_();\n\n      // Wait until the user is authorized.\n      if (gapi.analytics.auth.isAuthorized()) {\n        this.getActiveUsers_();\n      }\n      else {\n        gapi.analytics.auth.once('success', this.getActiveUsers_.bind(this));\n      }\n    },\n\n    stop: function() {\n      clearTimeout(this.timeout_);\n      this.polling_ = false;\n      this.emit('stop', {activeUsers: this.activeUsers});\n    },\n\n    render_: function() {\n      var opts = this.get();\n\n      // Render the component inside the container.\n      this.container = typeof opts.container == 'string' ?\n          document.getElementById(opts.container) : opts.container;\n\n      this.container.innerHTML = opts.template || this.template;\n      this.container.querySelector('b').innerHTML = this.activeUsers;\n    },\n\n    getActiveUsers_: function() {\n      var options = this.get();\n      var pollingInterval = (options.pollingInterval || 5) * 1000;\n\n      if (isNaN(pollingInterval) || pollingInterval < 5000) {\n        throw new Error('Frequency must be 5 seconds or more.');\n      }\n\n      this.polling_ = true;\n      gapi.client.analytics.data.realtime\n        .get({ids:options.ids, metrics:'rt:activeUsers'})\n        .execute(function(response) {\n\n          var newValue = response.totalResults ? +response.rows[0][0] : 0;\n          var oldValue = this.activeUsers;\n\n          this.emit('success', {activeUsers: this.activeUsers});\n\n          if (newValue != oldValue) {\n            this.activeUsers = newValue;\n            this.onChange_(newValue - oldValue);\n          }\n\n          if (this.polling_ = true) {\n            this.timeout_ = setTimeout(this.getActiveUsers_.bind(this),\n                pollingInterval);\n          }\n        }.bind(this));\n    },\n\n    onChange_: function(delta) {\n      var valueContainer = this.container.querySelector('b');\n      if (valueContainer) valueContainer.innerHTML = this.activeUsers;\n\n      this.emit('change', {activeUsers: this.activeUsers, delta: delta});\n      if (delta > 0) {\n        this.emit('increase', {activeUsers: this.activeUsers, delta: delta});\n      }\n      else {\n        this.emit('decrease', {activeUsers: this.activeUsers, delta: delta});\n      }\n    },\n\n    template:\n      '<div class=\"ActiveUsers\">' +\n        'Active Users: <b class=\"ActiveUsers-value\"></b>' +\n      '</div>'\n\n  });\n\n});\n\n"],"sourceRoot":"/source/"}